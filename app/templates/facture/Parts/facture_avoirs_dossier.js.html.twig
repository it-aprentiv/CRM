<script language="javascript">
    $(document).on('blur', '.taux-tva-fact,.taux-tva-factavoir', function() {
        loadMntValue($(this));
    });
    $(document).on('blur','.mnthtnfact ',function(e){
        calculatettlht($(this));
    });
    $(document).on('keyup','.mnthtnfact',function(e){
        calculatettlht($(this));
    });
    $(document).on('blur','.mnthtnfactavoir ',function(e){
        calculatettlhtav($(this));
    });
    $(document).on('keyup','.mnthtnfactavoir',function(e){
        calculatettlhtav($(this));
    });

    function loadMntValue(element) {
        var value = element.val();

        //var valueField = elt.val().replace(/[^0-9\.]/g, '');
        value = value.replace(',', '.');

        value = value.replace(/[^0-9\.]/g, '');

        element.val(value);

        value = (value === '') ? 0 : value;
        var brutHT = $(element.attr('data-ht')).val();
        brutHT = brutHT.replace(' ', '');
        brutHT = brutHT.replace(',', '.');
        brutHT = (brutHT === '') ? 0 : brutHT;
        var htField = parseFloat(brutHT);
        var tvaField = $(element.attr('data-tva'));
        var ttcField = $(element.attr('data-ttc'));
        var mntTva = parseFloat(value) * htField / 100;
        var mntTTC = htField + mntTva;
        tvaField.val(numberUtils.format(mntTva, 2, ',', ' '));
        ttcField.val(numberUtils.format(mntTTC, 2, ',', ' '));
    }

    function calculatettlht(element){
        var ttlhtelem = $('.'+$(element).data('ttlht'));
        var sum = "0.00";
        var otherht = $(".mnthtnfact").not($(element)).val().replace(',', '.').replace(' ', '');
        var htval = $(element).val().replace(',', '.').replace(' ', '');
        if(otherht == ""){
            otherht = "0.00";
        }
        if(htval == ""){
            htval = "0.00";
        }
        sum = parseFloat(otherht) + parseFloat(htval);
        $(ttlhtelem).val(sum);
        $(ttlhtelem).blur();
        
        if($(".taux-tva-fact").val() == ""){
            $(".taux-tva-fact").val(0);
        }
        
        loadMntValue($(".taux-tva-fact"));
    }

    function calculatettlhtav(element){
        var ttlhtelem = $('.'+$(element).data('ttlht'));
        var sum = "0.00";
        var otherht = $(".mnthtnfactavoir").not($(element)).val().replace(',', '.').replace(' ', '');
        var htval = $(element).val().replace(',', '.').replace(' ', '');
        if(otherht == ""){
            otherht = "0.00";
        }
        if(htval == ""){
            htval = "0.00";
        }
        sum = parseFloat(otherht) + parseFloat(htval);
        $(ttlhtelem).val(sum);
        $(ttlhtelem).blur();
        if($(".taux-tva-factavoir").val() == ""){
            $(".taux-tva-factavoir").val(0);
        }
        loadMntValue($(".taux-tva-factavoir"));
    }
</script>